(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{2100:function(e,t,n){"use strict";(function(e){var a,r=n(0),o=n.n(r),i=n(3),c=n.n(i),l=n(31),s=n.n(l),p=n(4),u=n.n(p),m=n(15),d=n(34),f=n(2),v=n(10),y=n(108),h=n(11),b=n(9),g=n.n(b),_=n(376),j=(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),x=function(){return(x=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},S=function(t,n,a,r){return new(a||(a=e))((function(e,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function c(e){try{l(r.throw(e))}catch(e){o(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(i,c)}l((r=r.apply(t,n||[])).next())}))},E=function(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t._goToNextStep=function(){var e=t.props,n=e.makeStepActive,a=e.markedVisited;n(1),a(0)},t._onSelectProject=function(e){return S(t,void 0,void 0,(function(){var t;return E(this,(function(n){try{this.props.updateProjectInfo("project",e.value),t=e.value.customer,s()(t)||(this.props.updateCustomerInfo("project",{name:t.name,govNumber:t.govNumber,email:c()(t,"contacts[0].email",""),contactName:c()(t,"contacts[0].name",""),contactSurname:c()(t,"contacts[0].surname",""),id:t.id}),this._goToNextStep())}catch(e){Object(h.a)(e.toString())}return[2]}))}))},t}return j(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.classes,a=t.projects,r=t.newInvoice,i=t.theme,l=c()(r,"project.project",{});return o.a.createElement("div",null,o.a.createElement(f.SectionHeader,{title:"Create an invoice using a project",subtitle:"Creating an invoice from a project is a quick way to easily create an invoice from a project which you have already defined.",renderLeftPart:function(){return o.a.createElement("div",{className:n.prevNextWrapper},o.a.createElement(f.Button,{id:"next-button",title:"Next",classes:{component:n.sendInvoiceButton},applyBorderRadius:!0,compactMode:!0,buttonColor:i.palette.primary.color2,onClick:e._goToNextStep}))}}),o.a.createElement("div",{className:n.content},o.a.createElement(u.a,{container:!0},o.a.createElement(u.a,{item:!0,xs:12,sm:4},o.a.createElement(f.SectionHeader,{title:"Select From Project"}),o.a.createElement("form",{className:n.form},o.a.createElement(f.Dropdown,{id:"project-dropdown",label:"Projects",value:l,onChange:this._onSelectProject,items:a.data.map((function(e){return{label:e.name,value:e}}))}))))))},t}(r.Component);t.a=Object(d.compose)(Object(f.withStyles)(_.a),Object(m.b)((function(e){return{profile:e.profile,newInvoice:g()(e,(function(e){return e.sessionData.newInvoice}))}}),x({},y)),Object(v.withProjects)((function(e){return{variables:{where:{isArchived:!1},orderBy:"name_ASC"}}})))(w)}).call(this,n(21))},2347:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),i=n(71),c=n.n(i),l=n(63),s=n.n(l),p=n(15),u=n(18),m=n(2),d=n(5),f=n(27),v=n(108),y=n(467),h=n(468),b=n(2100),g=n(28),_=n(3),j=n.n(_),x=n(35),S=n.n(x),E=n(30),w=n.n(E),I=n(4),C=n.n(I),k=n(11),N=n(10),O=n(25),T=n(9),A=n.n(T),P=n(376),D=(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),B=function(){return(B=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},R=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,c=o.length;i<c;i++,r++)a[r]=o[i];return a},V=function(e){function t(t){var n=e.call(this,t)||this;return n._updateDisplayServices=function(e){var t=e.i18n,a=e.newInvoice,r=e.project,o=e.invoices,i=j()(o,"data",[]).reduce((function(e,t){return[].concat(e,t.items||[])}),[]),c=j()(r,"data.projectService",[]);c=c.filter((function(e){return e.service.billingType===O.f.FIXED}));for(var l=[],s=function(e){var n=c[e],r=j()(n,"service",{}),o=j()(n,"amount",""),s=j()(n,"amount",""),p=j()(a,"project.tableData",[]),u=S()(p,{serviceId:r.id}),m=!1,d=0,f=(i||[]).filter((function(e){return e.service.id===r.id}))||[];if(f.length>=2)return"continue";if(j()(f,"0")){var v=j()(n,"rules",[]);(h=S()(v,{type:O.d.PROJECT_ENDS}))&&(o=Number(j()(h,"amount","0")),d=0)}else{v=j()(n,"rules",[]);var y=S()(v,{type:O.d.PROJECT_STARTS}),h=S()(v,{type:O.d.PROJECT_ENDS});y&&(o=Number(j()(y,"amount","0")),d=Number(j()(h,"amount","0"))),0===Number(o)&&(m=!0)}var b=r.includeConsTax?.1*Number(o||0):0;l.push({hash:n.id,id:n.id,service:r.name,serviceId:r.id,status:"Started",amount:Number(o),amount_str:t._("currency-symbol")+""+o,remainder:d,remainder_str:t._("currency-symbol")+""+d,gst:b,gst_str:t._("currency-symbol")+""+b,select:!u||u.select,amountEditable:m,maxAmount:s,includeConsTax:r.includeConsTax,billingType:r.billingType,rules:n.rules||[]})},p=0;p<c.length;p++)s(p);n.props.updateTableData("project",l)},n._updateSelectedServiceSelection=function(e){var t=n.props.newInvoice,a=j()(t,"project.tableData",[]),r=S()(a,{id:e.id});r&&(r.select=!e.select,n.props.updateTableData("project",a))},n._onUpdateAmount=function(e,t){var a=n.props.i18n,r=n.props.newInvoice,o=j()(r,"project.tableData",[]),i=S()(o,{id:e.id});if(Number(t)>Number(e.maxAmount)&&(Object(k.a)("You are trying to enter amount which is more than "+e.maxAmount),t=t.substr(0,t.length-1)),i){var c=i.includeConsTax?.1*Number(t||0):0;i.amount=Number(t),i.amount_str=a._("currency-symbol")+""+t,i.gst=c,i.gst_str=a._("currency-symbol")+""+c,i.remainder=Number(e.maxAmount)-i.amount,i.remainder_str=a._("currency-symbol")+""+i.remainder,n.props.updateTableData("project",R(o))}},n._renderCell=function(e,t,a){var r=n.props.classes;return"service"===t.id?o.a.createElement("div",{className:r.serviceCell},o.a.createElement(m.Checkbox,{id:"service-select-"+e.serviceId,size:"medium",value:e.select,onChange:function(){n._updateSelectedServiceSelection(e)},label:e[t.id]})):"amount_str"===t.id?o.a.createElement("div",{className:r.serviceCell},o.a.createElement(m.TextField,{id:"amount-input-"+e.serviceId,placeholder:"0",showClearIcon:!1,isNumber:!0,value:String(e.amount),icon:o.a.createElement("span",{className:r.dollarIcon},o.a.createElement(g.Trans,{id:"currency-symbol"})),classes:{textInputWrapper:r.tableInputWrapper,leftIcon:r.inputLeftIcon,textInput:r.gstTextInput},isReadOnly:!e.amountEditable,onChangeText:function(t){n._onUpdateAmount(e,t)}})):"remainder_str"===t.id?o.a.createElement("div",{className:r.serviceCell},o.a.createElement(m.TextField,{id:"amount-input-"+e.serviceId,placeholder:"0",isNumber:!0,showClearIcon:!1,value:String(e.remainder),icon:o.a.createElement("span",{className:r.dollarIcon},o.a.createElement(g.Trans,{id:"currency-symbol"})),classes:{textInputWrapper:r.tableInputWrapper,leftIcon:r.inputLeftIcon,textInput:r.gstTextInput},isReadOnly:!0})):a},n.state={columnData:[{id:"service",label:"Service",classes:{cellValueText:t.classes.smallTextCell}},{id:"status",label:"Status"},{id:"amount_str",label:"Amount"},{id:"remainder_str",label:"Remainder"}],hookups:{}},n}return D(t,e),t.prototype.componentDidMount=function(){this._updateDisplayServices(this.props)},t.prototype.componentDidUpdate=function(e){w()(j()(e,"project.data"),j()(this.props,"project.data"))&&w()(j()(e,"invoices.data"),j()(this.props,"invoices.data"))||this._updateDisplayServices(this.props)},t.prototype.render=function(){var e=this.props,t=e.classes,n=e.makeStepActive,a=e.markedVisited,r=e.unmarkedVisited,i=e.theme,c=e.newInvoice,l=j()(c,"project.tableData",[]),s=j()(c,"project.customer",{});return o.a.createElement("div",null,o.a.createElement(m.SectionHeader,{title:"Create an invoice using a project",subtitle:"Creating an invoice from a project is a quick way to easily create an invoice from a project which you have already defined.",renderLeftPart:function(){return o.a.createElement("div",{className:t.prevNextWrapper},o.a.createElement(m.Button,{title:"Prev",classes:{component:t.prevNextButton},applyBorderRadius:!0,compactMode:!0,buttonColor:i.palette.primary.color2,withoutBackground:!0,onClick:function(){n(0),r(0)}}),o.a.createElement(m.Button,{title:"Next",id:"next-button",classes:{component:t.prevNextButton},applyBorderRadius:!0,compactMode:!0,buttonColor:i.palette.primary.color2,onClick:function(){n(2),a(1)}}))}}),o.a.createElement("div",{className:t.content},o.a.createElement("div",{className:t.selectedProjectInfo},o.a.createElement("div",{className:t.selectedProjectName,"data-test":"customer-name"},j()(s,"name","")),o.a.createElement("div",{className:t.selectedProjectContact,"data-test":"contact-name"},j()(s,"contactName","")," ",j()(s,"contactSurname","")),o.a.createElement("div",{className:t.selectedProjectEmail,"data-test":"contact-email"},j()(s,"email",""))),o.a.createElement(m.SectionHeader,{title:"Project details"}),o.a.createElement(C.a,{container:!0,spacing:16},o.a.createElement(C.a,{item:!0,xs:12},o.a.createElement(m.Table,{columnData:this.state.columnData,data:l,sortable:!1,stripe:!1,showRemoveIcon:!1,cellRenderer:this._renderCell})))))},t}(r.Component),W=Object(u.compose)(Object(g.withI18n)(),Object(m.withStyles)(Object(m.composeStyles)(P.a,P.b)),Object(p.b)((function(e){return{profile:e.profile,newInvoice:A()(e,(function(e){return e.sessionData.newInvoice}))}}),B({},v)),Object(N.withProject)((function(e){return{id:j()(e,"newInvoice.project.project.id","")}})),Object(N.withInvoices)((function(e){return{variables:{where:{items_every:{project:{id:j()(e,"newInvoice.project.project.id","")}}}}}})))(V),z=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),F=function(){return(F=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},L=function(e){function t(t){var n=e.call(this,t)||this;n._updateSteps=function(e){var t=n.state.steps,a=c()(t,{active:!0});a>-1&&(t[a]=F(F({},t[a]),{active:!1}),t[e]=F(F({},t[e]),{active:!0}),n.setState({steps:t}))},n._makeStepActive=function(e){n.props.history.push(d.a.CREATE_PROJECT_TO_INVOICES()+"?step="+(e+1))},n._markedVisited=function(e){var t=n.state.steps;t[e]=F(F({},t[e]),{visited:!0}),n.setState({steps:t})},n._unmarkedVisited=function(e){var t=n.state.steps;t[e]=F(F({},t[e]),{visited:!1}),n.setState({steps:t})},n._onStepClick=function(e,t){n._makeStepActive(t)},n._cancelInvoice=function(){var e=n.props.theme,t=o.a.createElement("div",null,o.a.createElement("div",null,"Are you sure you want to cancel this invoice ?"),o.a.createElement("br",null),o.a.createElement("div",null,"All your unsaved invoice data will be lost. ")),a=[{title:"Close",type:"cancel",onClick:function(){n.props.actions.closeAlertDialog()}},{title:"Cancel",onClick:function(){n.props.actions.closeAlertDialog(),n.props.history.push(d.a.INVOICES())}}],r=e.palette.primary.color2;n.props.actions.showAlertDialog({title:"Cancel Invoice?",description:t,buttons:a,titleColor:r})};var a=s.a.parse(t.location.search),r=0;return a.step&&(r=a.step-1),n.state={steps:[{label:"Projects",active:0===r,component:o.a.createElement(b.a,{makeStepActive:n._makeStepActive,markedVisited:n._markedVisited,unmarkedVisited:n._unmarkedVisited})},{label:"Services",active:1===r,component:o.a.createElement(W,{makeStepActive:n._makeStepActive,markedVisited:n._markedVisited,unmarkedVisited:n._unmarkedVisited})},{label:"Details",active:2===r,component:o.a.createElement(y.a,F({},n.props,{createType:"project",makeStepActive:n._makeStepActive,markedVisited:n._markedVisited,unmarkedVisited:n._unmarkedVisited}))},{label:"Review",active:3===r,component:o.a.createElement(h.a,F({},t,{createType:"project",actions:n.props.actions,makeStepActive:n._makeStepActive,markedVisited:n._markedVisited,unmarkedVisited:n._unmarkedVisited}))}]},n}return z(t,e),t.prototype.componentDidMount=function(){this.props.actions.updateHeaderTitle("Invoices")},t.prototype.componentDidUpdate=function(e){if(this.props.location.search!==e.location.search){var t=s.a.parse(this.props.location.search);t.step?this._updateSteps(t.step-1):this._updateSteps(1)}},t.prototype.render=function(){var e=this,t=this.props.classes;return o.a.createElement(m.ErrorBoundary,null,o.a.createElement(f.a,{onChange:function(){e.props.resetInvoiceData("project"),e.props.history.push(d.a.CREATE_INVOICES())}},o.a.createElement("div",{className:t.page},o.a.createElement("div",{className:t.allSteps},o.a.createElement(m.WizardSteps,{steps:this.state.steps,onStepClick:this._onStepClick})),o.a.createElement("div",{className:t.draftButtonWrapper},o.a.createElement(m.Button,{title:"Cancel",classes:{text:t.cancelButtonText},buttonColor:"#EAEAEA",onClick:this._cancelInvoice}),o.a.createElement(m.Button,{title:"Save as draft",buttonColor:"#29A9DB"})))))},t}(r.Component);t.default=Object(u.compose)(Object(m.withStyles)(P.a),Object(p.b)((function(){return{}}),{resetInvoiceData:v.resetInvoiceData}))(L)},376:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),t.a=function(e){return{page:{flex:1,display:"flex",flexDirection:"column",position:"relative"},allSteps:{padding:"40px 20px 100px"},prevNextWrapper:{display:"flex",alignItems:"center"},prevNextButton:{width:180,margin:"0px 10px"},smallTextCell:{fontSize:15},content:{marginTop:"50px !important"},formHeading:{marginTop:40},form:{marginTop:20},halfFieldWRow:{display:"flex",alignItems:"center"},input:{marginTop:10,position:"relative"},leftInput:{marginRight:10},draftButtonWrapper:{display:"flex",alignItems:"center",position:"absolute",left:0,right:0,bottom:0},checkbox:{margin:"10px 0px"},serviceInputWrapper:{margin:"30px 10px"},inputLabel:{color:e.palette.grey[400],fontSize:15,fontWeight:"bold",fontFamily:e.typography.font.family2,marginBottom:10},totalWrapper:{backgroundColor:e.palette.primary.color1,display:"flex",alignItems:"center",justifyContent:"space-between",padding:15,marginTop:20},totalLabel:{fontFamily:e.typography.font.family1,fontSize:32,color:"white"},totalValue:{fontFamily:e.typography.font.family1,fontSize:32,color:"white",fontWeight:"bold"},paymentOptions:{display:"flex",alignItems:"center"},paymentOption:{marginRight:10,border:"1px solid "+e.palette.primary.color2,borderRadius:5,cursor:"pointer",minWidth:100,padding:20,color:e.palette.primary.color2,textAlign:"center","&.selected":{backgroundColor:e.palette.primary.color2,color:"white"}},attachWrapper:{display:"flex",alignItems:"center"},attachButton:{height:52,display:"flex",alignItems:"center",justifyContent:"center",fontSize:25,padding:"0px 20px",backgroundColor:e.palette.primary.color2,marginTop:38,color:"white",borderTopRightRadius:5,borderBottomRightRadius:5},sendInvoiceButton:{width:250,margin:"0px 10px"},cancelButtonText:{color:e.palette.primary.color3}}};var a=function(e){return{selectedProjectInfo:{marginBottom:30},selectedProjectName:{color:e.palette.primary.color1,fontSize:24,fontFamily:e.typography.font.family1,fontWeight:"bold",marginBottom:10},selectedProjectContact:{fontSize:16,color:e.palette.blueGrey[50],fontFamily:e.typography.font.family2,marginBottom:5},selectedProjectEmail:{fontSize:16,color:e.palette.blueGrey[50],fontFamily:e.typography.font.family2,marginBottom:5},checkboxWrapper:{marginTop:55},checkboxRow:{display:"flex",alignItems:"center",justifyContent:"space-between"},questionIcon:{color:e.palette.grey[400],fontSize:25},serviceCell:{display:"flex",alignItems:"center",padding:"0px 10px"},tableInputWrapper:{borderRadius:0,border:"0px","&.is-filled":{backgroundColor:"white"}},inputLeftIcon:{padding:0,paddingLeft:10},dollarIcon:{fontSize:15,color:"#aaa"},gstTextInput:{paddingLeft:5,paddingRight:5}}}}}]);