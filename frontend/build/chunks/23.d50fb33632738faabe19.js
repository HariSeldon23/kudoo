(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{11:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(652),a=function(e,t){void 0===e&&(e=""),void 0===t&&(t="");var n=e?"error":"success",a=e||t;Object(r.b)(a,{type:n,closeButton:!1,hideProgressBar:!0})}},2172:function(e,t,n){"use strict";t.a=function(e){return{page:{flex:1,display:"flex",flexDirection:"column"},content:{padding:"40px 20px",flex:1,display:"flex",flexDirection:"column"},periodSelectionWrapper:{margin:"20px 0px"},inputs:{marginTop:30},textValueBox:{height:52,borderRadius:5,border:"1px solid "+e.palette.grey[300],display:"flex",alignItems:"center",padding:"0px 15px",fontFamily:e.typography.font.family2,fontSize:16,color:e.palette.blueGrey[50]},newRowButton:{marginTop:20},cancelButtonText:{color:e.palette.grey[500]},attachementWrapper:{marginTop:15},attachedFilesBlock:{display:"flex",alignItems:"center",flexWrap:"wrap"},attachementBlock:{border:"2px dashed "+e.palette.primary.color2,borderRadius:5}}}},2323:function(e,t,n){"use strict";n.r(t),function(e){var r,a=n(0),o=n.n(a),i=n(4),c=n.n(i),s=n(3),l=n.n(s),u=n(132),p=n.n(u),m=n(31),d=n.n(m),f=n(24),h=n.n(f),E=n(15),v=n(34),y=n(2),T=n(5),b=n(10),S=n(27),D=n(25),A=n(11),w=n(2172),O=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),g=function(){return(g=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},I=function(t,n,r,a){return new(r||(r=e))((function(e,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function c(e){try{s(a.throw(e))}catch(e){o(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,c)}s((a=a.apply(t,n||[])).next())}))},R=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getTimesheetRows=function(){var e=t.props.timeSheet,n=l()(e,"data.timeSheetEntries")||[],r={};return n.forEach((function(e){var t=l()(e,"project.id")||l()(e,"customer.id"),n=l()(e,"service.id"),a=e.project,o=e.customer,i=e.service,c=l()(e,"project.id")?"project":"customer",s=t+":"+n;r[s]=r[s]||{},p()(r[s],{id:s,rowType:c,project:{data:a},customer:{data:o},service:{data:i},entries:{data:[].concat(l()(r[s],"entries.data",[]),e)}})})),r},t._approveTimesheet=function(){return I(t,void 0,void 0,(function(){var e,t,n;return R(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=l()(this.props,"match.params.id"),[4,this.props.updateTimeSheet({where:{id:e},data:{status:D.g.APPROVED}})];case 1:return(t=r.sent()).success?Object(A.a)(null,"Timesheet Approved"):t.error.map((function(e){return Object(A.a)(e)})),[3,3];case 2:return n=r.sent(),Object(A.a)(n.toString()),[3,3];case 3:return[2]}}))}))},t._unApproveTimesheet=function(){return I(t,void 0,void 0,(function(){var e,t,n;return R(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=l()(this.props,"match.params.id"),[4,this.props.updateTimeSheet({where:{id:e},data:{status:D.g.FINALISED}})];case 1:return(t=r.sent()).success?Object(A.a)(null,"Timesheet UnApproved"):t.error.map((function(e){return Object(A.a)(e)})),[3,3];case 2:return n=r.sent(),Object(A.a)(n.toString()),[3,3];case 3:return[2]}}))}))},t._showInvoiceAlert=function(){var e=t.props.theme,n=o.a.createElement("div",null,o.a.createElement("div",null,"We will generate an invoice using the information defined in this timesheet."),o.a.createElement("br",null),o.a.createElement("div",null,"Are you sure you want us to send an invoice to your customer?")),r=[{title:"No, donâ€™t send",onClick:function(){t.props.actions.closeAlertDialog()}},{title:"Send invoice",onClick:function(){t.props.actions.closeAlertDialog()}}],a=e.palette.primary.color2;t.props.actions.showAlertDialog({title:"Send Invoice to customer?",description:n,buttons:r,titleColor:a})},t._renderBottomButtons=function(){var e=t.props,n=e.classes,r=e.theme,a=e.profile,i=l()(a,"selectedCompany.owner");return o.a.createElement(c.a,{container:!0,spacing:0},o.a.createElement(c.a,{item:!0,xs:12,sm:i?6:12},o.a.createElement(y.Button,{title:"Back to timesheets",href:T.a.TIMESHEETS(),buttonColor:r.palette.grey[200],classes:{text:n.cancelButtonText}})),i&&o.a.createElement(c.a,{item:!0,xs:12,sm:6},o.a.createElement(y.Button,{title:"Invoice to customer",buttonColor:r.palette.primary.color2,onClick:t._showInvoiceAlert})))},t}return O(t,e),t.prototype.componentDidMount=function(){this.props.actions.updateHeaderTitle("Timesheets")},t.prototype._renderSectionHeading=function(){var e=this.props,t=e.theme,n=e.profile,r=e.timeSheet,a=l()(n,"selectedCompany.owner"),i=l()(r,"data.status")===D.g.APPROVED,c=null;return a&&(c=i?o.a.createElement(y.Button,{title:"Unapprove Timesheet",applyBorderRadius:!0,width:260,buttonColor:t.palette.primary.color2,onClick:this._unApproveTimesheet}):o.a.createElement(y.Button,{title:"Approve Timesheet",applyBorderRadius:!0,width:260,buttonColor:t.palette.primary.color2,onClick:this._approveTimesheet})),o.a.createElement(y.SectionHeader,{title:"Review timesheet",subtitle:"This is a finalised timesheet. Review the details below and click Invoice Customer when you are ready to send an invoice for this work.",renderLeftPart:function(){return c}})},t.prototype._renderPeriodSelection=function(){var e=this.props,t=e.classes,n=e.timeSheet.data||{};return o.a.createElement("div",{className:t.periodSelectionWrapper},o.a.createElement(c.a,{container:!0,justify:"space-between",spacing:0},o.a.createElement(c.a,{item:!0,xs:12,sm:6},o.a.createElement(c.a,{container:!0,spacing:16},o.a.createElement(c.a,{item:!0,xs:12,sm:6},o.a.createElement("div",null,o.a.createElement(y.FieldLabel,{label:"Month"}),o.a.createElement("div",{className:t.textValueBox},h()(n.startsAt).format("MMMM")))),o.a.createElement(c.a,{item:!0,xs:12,sm:6},o.a.createElement("div",null,o.a.createElement(y.FieldLabel,{label:"Year"}),o.a.createElement("div",{className:t.textValueBox},h()(n.startsAt).format("YYYY")))))),o.a.createElement(c.a,{item:!0,xs:12,sm:6},o.a.createElement(c.a,{container:!0,justify:"flex-end"},o.a.createElement(c.a,{item:!0,xs:12,sm:8},o.a.createElement("div",null,o.a.createElement(y.FieldLabel,{label:"Week Period"}),o.a.createElement("div",{className:t.textValueBox},h()(n.startsAt).format("DD MMM")," -"," ",h()(n.endsAt).format("DD MMM"))))))))},t.prototype._renderInputs=function(){var e=this.props,t=e.classes,n=e.timeSheet.data||{},r=this._getTimesheetRows();return d()(r)?null:o.a.createElement("div",{className:t.inputs},Object.values(r).map((function(e,t){return o.a.createElement(y.TimesheetRowDisplay,{key:e.id,hideDaysLabel:t>0,startWeekDay:h()(n.startsAt).format(),endWeekDay:h()(n.endsAt).format(),project:e.project,customer:e.customer,service:e.service,timeSheetEntries:e.entries})})))},t.prototype._renderAttachmentField=function(){var e=this.props,t=e.classes,n=e.timeSheet,r=l()(n,"data.attachments",[]);return r.length<=0?null:o.a.createElement("div",{className:t.attachementWrapper},o.a.createElement(y.FieldLabel,{label:"Attachments"}),o.a.createElement("div",{className:t.attachementBlock},o.a.createElement("div",{className:t.attachedFilesBlock},r.map((function(e,t){return o.a.createElement(y.FileBlock,{key:t,file:g(g({},e),{name:e.fileName}),showRemoveButton:!1,variant:"interactive"})})))))},t.prototype.render=function(){var e=this,t=this.props.classes;return o.a.createElement(S.a,{onChange:function(){e.props.history.push(T.a.TIMESHEETS())}},o.a.createElement("div",{className:t.page},o.a.createElement("div",{className:t.content},this._renderSectionHeading(),this._renderPeriodSelection(),this._renderInputs(),this._renderAttachmentField()),this._renderBottomButtons()))},t}(a.Component);t.default=Object(v.compose)(Object(y.withStyles)(w.a),Object(E.b)((function(e){return{profile:e.profile}})),Object(b.withTimeSheet)((function(e){return{id:l()(e,"match.params.id")}})),Object(b.withUpdateTimeSheet)())(_)}.call(this,n(21))},25:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"d",(function(){return i})),n.d(t,"g",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return l}));var r="YYYY-MM-DD[T]HH:mm:ss.SSS[Z]",a={FIXED:"FIXED",TIME_BASED:"TIME_BASED"},o={STARTED:"STARTED",CLOSED:"CLOSED"},i={PROJECT_ENDS:"PROJECT_ENDS",PROJECT_STARTS:"PROJECT_STARTS"},c={APPROVED:"APPROVED",DRAFT:"DRAFT",FINALISED:"FINALISED",INVOICED:"INVOICED"},s={APPROVED:"APPROVED",ARCHIVED:"ARCHIVED",DRAFT:"DRAFT",FULLY_PAID:"FULLY_PAID",UNPAID:"UNPAID",PARTIALLY_PAID:"PARTIALLY_PAID",PROPOSED:"PROPOSED",REJECTED:"REJECTED"},l={PROJECT:"PROJECT",TIMESHEET:"TIMESHEET",TIMESHEET_WITH_DETAILS:"TIMESHEET_WITH_DETAILS",FREE_TEXT:"FREE_TEXT"}},27:function(e,t,n){"use strict";var r=n(0),a=n(18),o=n(15),i=n(317),c=n(9),s=n.n(c);t.a=Object(a.compose)(Object(o.b)((function(e){return{selectedCompany:s()(e,(function(e){return e.profile.selectedCompany}))}})))((function(e){var t=e.selectedCompany,n=e.onChange,a=e.children;return Object(i.a)((function(){n(t)}),[t]),r.createElement(r.Fragment,null,a)}))},317:function(e,t,n){"use strict";var r=n(30),a=n.n(r),o=n(0);function i(e){var t,n,r=Object(o.useRef)();return t=e,n=r.current,a()(t,n)||(r.current=e),r.current}t.a=function(e,t){Object(o.useEffect)(e,i(t))}}}]);