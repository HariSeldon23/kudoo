(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{11:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(652),o=function(e,t){void 0===e&&(e=""),void 0===t&&(t="");var r=e?"error":"success",o=e||t;Object(n.b)(o,{type:r,closeButton:!1,hideProgressBar:!0})}},173:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"e",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return a})),t.d=function(e){return{page:{flex:1,display:"flex",flexDirection:"column"}}};var n=function(e){return{page:{padding:"40px 20px",flex:1,display:"flex",flexDirection:"column"},noTimesheetsWrapper:{flex:1,alignItems:"center",justifyContent:"center",display:"flex",margin:"50px 0px",cursor:"pointer"},noTimesheetsMessageWrapper:{width:"60%",maxWidth:660,margin:"0px auto",border:"4px dashed "+e.palette.grey[300],padding:10,borderRadius:20,minHeight:200,backgroundColor:e.palette.grey[100],alignItems:"center",justifyContent:"center",display:"flex"},noTimesheetsMessage:{fontFamily:e.typography.font.family1,fontSize:26,lineHeight:"35px",fontWeight:"500",color:e.palette.blueGrey[50],textAlign:"center"},dropdownWrapper:{marginTop:20,marginBottom:20},timesheetsContainer:{marginTop:"20px !important"},timesheet:{marginBottom:30},expandHideWrapper:{flexDirection:"row",display:"flex",alignItems:"center",justifyContent:"flex-end",marginBottom:20},expandHideLabel:{fontSize:15,color:e.palette.grey[300],fontFamily:e.typography.font.family2,cursor:"default",pointerEvents:"none","&.active":{color:e.palette.blueGrey[50],cursor:"pointer",pointerEvents:"initial"}},slash:{fontSize:15,color:e.palette.grey[300],fontFamily:e.typography.font.family2,margin:"0px 5px"}}},o=function(e){return{wrapper:{},titleWrapper:{padding:20,flexDirection:"row",display:"flex",alignItems:"center",backgroundColor:e.palette.primary.color1,borderTopLeftRadius:5,borderTopRightRadius:5,cursor:"pointer","&.is-company":{backgroundColor:e.palette.primary.color3},"&.is-collapsed":{borderRadius:5}},title:{fontSize:24,color:"white",fontWeight:"bold",fontFamily:e.typography.font.family1,flex:1},type:{fontSize:24,color:e.palette.shadow.color1,fontWeight:"bold",fontFamily:e.typography.font.family1,paddingRight:20},arrowIcon:{color:"white",fontSize:25,marginRight:10,transition:"all 0.2s ease-in",transform:"rotate(0deg)","&.is-open":{transform:"rotate(90deg)"}},serviceInfoWrapper:{backgroundColor:e.palette.grey[200],padding:"15px 20px",flexDirection:"row",display:"flex",alignItems:"center"},serviceName:{fontSize:16,color:e.palette.grey[500],fontWeight:"500",fontFamily:e.typography.font.family2,flex:1},companyName:{fontSize:16,color:e.palette.grey[400],fontWeight:"500",fontFamily:e.typography.font.family2},statusCell:{paddingLeft:24,paddingRight:24,fontWeight:"bold","&.orange":{color:e.palette.secondary.color1},"&.green":{color:e.palette.primary.color1}},emailColumn:{width:"5%"},emailIconCell:{fontSize:20,color:e.palette.primary.color1,cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",paddingLeft:24,paddingRight:24,borderLeft:"1px solid "+e.palette.grey[200],minHeight:50},tableRowRoot:{cursor:"pointer","&:hover":{backgroundColor:e.palette.grey[50]}}}},i=function(e){return{emailInputs:{marginTop:15}}},a=function(e){return{commonCell:{paddingLeft:24,paddingRight:24,minHeight:50,display:"flex",alignItems:"center"},modalDescription:{padding:"0px !important",width:"100%"}}}},25:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"f",(function(){return o})),r.d(t,"e",(function(){return i})),r.d(t,"d",(function(){return a})),r.d(t,"g",(function(){return s})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c}));var n="YYYY-MM-DD[T]HH:mm:ss.SSS[Z]",o={FIXED:"FIXED",TIME_BASED:"TIME_BASED"},i={STARTED:"STARTED",CLOSED:"CLOSED"},a={PROJECT_ENDS:"PROJECT_ENDS",PROJECT_STARTS:"PROJECT_STARTS"},s={APPROVED:"APPROVED",DRAFT:"DRAFT",FINALISED:"FINALISED",INVOICED:"INVOICED"},l={APPROVED:"APPROVED",ARCHIVED:"ARCHIVED",DRAFT:"DRAFT",FULLY_PAID:"FULLY_PAID",UNPAID:"UNPAID",PARTIALLY_PAID:"PARTIALLY_PAID",PROPOSED:"PROPOSED",REJECTED:"REJECTED"},c={PROJECT:"PROJECT",TIMESHEET:"TIMESHEET",TIMESHEET_WITH_DETAILS:"TIMESHEET_WITH_DETAILS",FREE_TEXT:"FREE_TEXT"}},27:function(e,t,r){"use strict";var n=r(0),o=r(18),i=r(15),a=r(317),s=r(9),l=r.n(s);t.a=Object(o.compose)(Object(i.b)((function(e){return{selectedCompany:l()(e,(function(e){return e.profile.selectedCompany}))}})))((function(e){var t=e.selectedCompany,r=e.onChange,o=e.children;return Object(a.a)((function(){r(t)}),[t]),n.createElement(n.Fragment,null,o)}))},317:function(e,t,r){"use strict";var n=r(30),o=r.n(n),i=r(0);function a(e){var t,r,n=Object(i.useRef)();return t=e,r=n.current,o()(t,r)||(n.current=e),n.current}t.a=function(e,t){Object(i.useEffect)(e,a(t))}},471:function(e,t,r){"use strict";var n,o=r(0),i=r.n(o),a=r(7),s=r.n(a),l=r(71),c=r.n(l),u=r(30),p=r.n(u),d=r(24),f=r.n(d),h=r(131),m=r.n(h),y=r(2),g=r(173),v=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),E=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},w=function(e){function t(t){var r=e.call(this,t)||this;r._onRequestSort=function(e){var t=r.state,n=t.tableColumns,o=t.tableData,i=c()(n,{id:e.id}),a=n[i],s=c()(n,{sorted:!0}),l=n[s];l&&s!==i&&(l.sorted=!1,n[s]=l),a.sorted?(a.order="asc"===a.order?"desc":"asc",n[i]=a):(a.sorted=!0,a.order="asc",n[i]=a);var u=a.order;"user"===e.id||"status"===e.id?o.sort((function(t,r){return"asc"===u?t[e.id]-r[e.id]:r[e.id]-t[e.id]})):"period"===e.id?o.sort((function(e,t){return f()(e.startsAt).isBefore(t.startsAt)?"asc"===u?-1:1:f()(e.startsAt).isAfter(t.startsAt)?"asc"===u?1:-1:0})):"hours"===e.id&&o.sort((function(e,t){return"asc"===u?e.totalHours-t.totalHours:t.totalHours-e.totalHours})),r.setState({tableColumns:n,tableData:o})},r._renderCell=function(e,t,n){var o=r.props.classes;if("status"===t.id){var a=e[t.id];return i.a.createElement("div",{className:s()(o.statusCell,"green")},a)}return"email"===t.id?i.a.createElement("div",{className:o.emailIconCell},i.a.createElement(y.Tooltip,{title:"Send timesheet notification email"},(function(){return i.a.createElement("i",{className:"fa fa-envelope-o"})}))):"view"===t.id?i.a.createElement("div",{className:o.emailIconCell},i.a.createElement(y.Tooltip,{title:"View Timesheet Details"},(function(){return i.a.createElement("i",{className:"fa fa-eye"})}))):n};var n=[{id:"user",label:"User"},{id:"period",label:"Period"},{id:"status",label:"Status"},{id:"hours",label:"Unit"}];return t.showEmailIcon&&(n=E(n,[{id:"email",label:"",notSortable:!0,classes:{tableHeaderCellWrapper:t.classes.emailColumn}}])),t.showViewIcon&&(n=E(n,[{id:"view",label:"",notSortable:!0,classes:{tableHeaderCellWrapper:t.classes.emailColumn}}])),r.state={tableColumns:n,collapsed:t.collapsed||!1,tableData:t.rows||[]},r}return v(t,e),t.prototype.componentDidUpdate=function(e){this.props.collapsed!==e.collapsed&&this.setState({collapsed:this.props.collapsed}),p()(this.props.rows,e.rows)||this.setState({tableData:this.props.rows})},t.prototype.render=function(){var e=this,t=this.props,r=t.classes,n=t.type,o=t.serviceName,a=t.companyName,l=t.project,c=t.showRemoveIcon,u=t.showAddIcon,p=this.state.collapsed;return i.a.createElement("div",{className:r.wrapper,"data-test":"timesheet-block"},i.a.createElement("div",{className:s()(r.titleWrapper,{"is-company":"company"===n,"is-collapsed":p}),onClick:function(){e.setState({collapsed:!p})}},i.a.createElement("div",{className:r.title},"project"===n?l:"Linked to Company"),"project"===n&&i.a.createElement("div",{className:r.type},"Project"),i.a.createElement("i",{className:s()(r.arrowIcon,"ion-chevron-right",{"is-open":!p})})),i.a.createElement(m.a,{in:!this.state.collapsed,timeout:"auto",unmountOnExit:!0},i.a.createElement("div",{className:r.serviceInfoWrapper},i.a.createElement("div",{className:r.serviceName},o),i.a.createElement("div",{className:r.companyName},a)),i.a.createElement(y.Table,{columnData:this.state.tableColumns,data:this.state.tableData,showRemoveIcon:c,showAddIcon:u,stripe:!1,sortable:!0,onRequestSort:this._onRequestSort,cellRenderer:this._renderCell,onCellClick:this.props.onCellClick,onRemoveClicked:this.props.onRemoveClicked,onAddClicked:this.props.onAddClicked,classes:{tableRowRoot:r.tableRowRoot}})))},t.defaultProps={collapsed:!1,type:"project",showEmailIcon:!0,showViewIcon:!0,showRemoveIcon:!1,onRemoveClicked:function(){},showAddIcon:!1,onAddClicked:function(){}},t}(o.Component);t.a=Object(y.withStyles)(g.e)(w)},472:function(e,t,r){"use strict";(function(e){var n,o=r(0),i=r.n(o),a=r(30),s=r.n(a),l=r(3),c=r.n(l),u=r(132),p=r.n(u),d=r(370),f=r.n(d),h=r(15),m=r(24),y=r.n(m),g=r(18),v=r(2),E=r(10),w=r(11),b=r(27),D=r(25),A=r(173),C=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),S=function(){return(S=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},T=function(t,r,n,o){return new(n||(n=e))((function(e,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(a,s)}l((o=o.apply(t,r||[])).next())}))},I=function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},R=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={timeSheetData:void 0,showViewEntriesModal:!1,showingEntriesInModal:[]},t._onCompanyChange=function(){t.props.users&&t.props.users.refetch(),t.props.timeSheets&&t.props.timeSheets.refetch()},t._updateTimesheetsData=function(e){for(var r,n=e.timeSheets,o={},i=c()(n,"data",[]),a=0;a<i.length;a++)for(var s=i[a]||{},l=s.id,u=s.timeSheetEntries||[],p=0;p<u.length;p++){var d=u[p],h=c()(d,"project.id"),m=c()(d,"customer.id"),g=(h||m)+":"+c()(d,"service.id"),v=o[g]||{},E=v.rows||{},w=c()(E,""+l)||{hours:0,entries:[]},b=w.hours+Number(d.duration||0)||0,D=R(w.entries,[d]),A=f()(D,{isInvoiced:!0})||[],C=s.status;A.length>0&&(C=A.length===D.length?"INVOICED":"PARTIALLY INVOICED"),o[g]=S(S({},v),{id:g,service:d.service,customer:d.customer,project:d.project,rows:S(S({},E),(r={},r[l]={id:l,user:s.user,hours:b,status:C,startsAt:y()(s.startsAt).format("DD MMM YYYY"),endsAt:y()(s.endsAt).format("DD MMM YYYY"),startsAtFormatted:y()(s.startsAt).format(),entries:D},r))})}t.setState({timeSheetData:o})},t._archiveTimesheet=function(e){return T(t,void 0,void 0,(function(){var t,r;return I(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.props.updateTimeSheet({where:{id:e.id},data:{isArchived:!0}})];case 1:return(t=n.sent()).success?(Object(w.a)(null,"Timesheet archived successfully"),this.props.timeSheets.refetch()):t.error.map((function(e){return Object(w.a)(e)})),[3,3];case 2:return r=n.sent(),Object(w.a)("Something went wrong: "+r.toString()),[3,3];case 3:return[2]}}))}))},t._unArchiveTimesheet=function(e){return T(t,void 0,void 0,(function(){var t,r;return I(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.props.updateTimeSheet({where:{id:e.id},data:{isArchived:!1}})];case 1:return(t=n.sent()).success?(Object(w.a)(null,"Timesheet unarchived successfully"),this.props.timeSheets.refetch()):t.error.map((function(e){return Object(w.a)(e)})),[3,3];case 2:return r=n.sent(),Object(w.a)("Something went wrong: "+r.toString()),[3,3];case 3:return[2]}}))}))},t._showArchiveDialog=function(e){var r=t.props,n=r.theme,o=r.actions,a=i.a.createElement("div",null,i.a.createElement("div",null,"Are you sure you want to archive timesheet?")),s=[{title:"Cancel",type:"cancel",onClick:function(){o.closeAlertDialog()}},{title:"Archive",onClick:function(){o.closeAlertDialog(),t._archiveTimesheet(e)}}],l=n.palette.primary.color2;t.props.actions.showAlertDialog({title:"Archive timesheet?",description:a,buttons:s,titleColor:l})},t._showUnarchiveDialog=function(e){var r=t.props,n=r.theme,o=r.actions,a=i.a.createElement("div",null,i.a.createElement("div",null,"Are you sure you want to unarchive timesheet?")),s=[{title:"Cancel",type:"cancel",onClick:function(){o.closeAlertDialog()}},{title:"Unarchive",onClick:function(){o.closeAlertDialog(),t._unArchiveTimesheet(e)}}],l=n.palette.primary.color2;t.props.actions.showAlertDialog({title:"Unarchive timesheet?",description:a,buttons:s,titleColor:l})},t._toggleViewEntriesModal=function(e,r){void 0===r&&(r=[]),t.setState({showViewEntriesModal:e,showingEntriesInModal:r})},t}return C(t,e),t.prototype.componentDidMount=function(){this._updateTimesheetsData(this.props)},t.prototype.componentDidUpdate=function(e){var t=this.props.timeSheets;s()(t,e.timeSheets)||this._updateTimesheetsData(this.props)},t.prototype.render=function(){var e=this.props,t=e.children,r=e.actions,n=e.history,o=e.location,a=e.match,s=e.addFilteredUser,l=e.removeFilteredUser,u=e.onlyMyTimesheet,p=e.users,d=e.timeSheets,f=c()(d,"loading");return i.a.createElement(v.ErrorBoundary,null,i.a.createElement(b.a,{onChange:this._onCompanyChange},t(S(S({},this.state),{actions:r,history:n,location:o,match:a,addFilteredUser:s,removeFilteredUser:l,users:c()(p,"data",[]).filter((function(e){return e.firstName&&e.lastName})),showArchiveDialog:this._showArchiveDialog,showUnarchiveDialog:this._showUnarchiveDialog,toggleViewEntriesModal:this._toggleViewEntriesModal,onlyMyTimesheet:u,timeSheetsLoading:f,loadMore:c()(d,"loadNextPage")}))))},t}(o.Component);t.a=Object(g.compose)(Object(v.withStyles)(A.d),Object(g.withStateHandlers)({filteredUsers:[]},{addFilteredUser:function(e){var t=e.filteredUsers;return function(e){var r=R(t);return r.push(e.id),{filteredUsers:r}}},removeFilteredUser:function(e){var t=e.filteredUsers;return function(e){var r=R(t),n=r.indexOf(e.id);return r.splice(n,1),{filteredUsers:r}}}}),Object(h.b)((function(e){return{profile:e.profile}})),Object(E.withUpdateTimeSheet)(),Object(E.withTimeSheets)((function(e){var t=e.timesheet_type,r=e.profile||{},n={first:10,where:{},orderBy:"startsAt_DESC"};return"active"===t?n=p()(n,{where:{isArchived:!1,status_not:D.g.DRAFT}}):"draft"===t?n=p()(n,{where:{isArchived:!1,status:D.g.DRAFT}}):"archived"===t&&(n=p()(n,{where:{isArchived:!0}})),e.onlyMyTimesheet&&(n=p()(n,{where:{user:{id:r.id}}})),e.filteredUsers&&e.filteredUsers.length&&(n=p()(n,{where:{user:{id_in:e.filteredUsers}}})),{variables:n}})),Object(E.withCompany)((function(e){return{id:c()(e.profile,"selectedCompany","").id}}),(function(e){var t=e.data;return{users:{data:(c()(t,"company.companyMembers")||[]).map((function(e){return e.user})),loading:t.loading,refetch:t.refetch}}})))(_)}).call(this,r(21))}}]);